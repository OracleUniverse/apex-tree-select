/*!
 * xx_tree_select.js
 * Oracle APEX friendly Tree + Checkbox widget
 * - Progressive loading (roots + children via plugin AJAX).
 * - Tri-state logic, allowParent/allowLeaf rules.
 * - Search (client or server) with highlight and ancestor expansion.
 * - Expand/Collapse All.
 *
 * Requires: apex.server, apex.jQuery, apex.util
 * Safe for CSP (no inline eval).
 */
!function(e,t,n){"use strict";var i=!0,a="";function r(e){return null==e?null:String(e)}function l(e){return n.escapeHTML(String(null==e?"":e))}function s(e){if(!e)return/$a^/;var t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return t=t.replace(/%/g,".*").replace(/_/g,"."),new RegExp(t,"ig")}function o(e){return n.escapeCSS(String(null==e?"":e))}function d(e,t){for(var n=0;n<t.length;n++)if(a=e,r=t[n],Object.prototype.hasOwnProperty.call(a,r)){var i=e[t[n]];return!0===i||1===i||"1"===i||"true"===i?1:0}var a,r;return 0}function c(e,t){for(var n=0;n<t.length;n++)if(null!=e[t[n]])return e[t[n]];return null}function u(e,t){var n=apex.region&&e.staticId?apex.region(e.staticId):null;return n&&n.showSpinner&&n.showSpinner(),new Promise((function(i,a){apex.server.plugin(e.ajaxIdentifier,t,{dataType:"json",success:function(e){i(e||[])},error:function(e){var t=e&&(e.responseJSON||e.responseText)||e;console.error("[TreeSelect] AJAX error:",t),a(e)},complete:function(){n&&n.hideSpinner&&n.hideSpinner()}})}))}function h(e,n){var i=t('<div class="ts-busyOverlay"></div>');e.append(i).addClass("is-busy");var a=apex.region&&e.attr("id")?apex.region(e.attr("id")):null;return a&&a.showSpinner&&a.showSpinner(),Promise.resolve().then((()=>n)).finally((()=>{i.remove(),e.removeClass("is-busy"),a&&a.hideSpinner&&a.hideSpinner()}))}function f(e){if(!a)return l(e);var t=s(a);return l(String(e)).replace(t,(function(e){return'<mark class="ts-hit">'+e+"</mark>"}))}function p(e,t){var n=function(e){var t=r(c(e,["id"])),n=c(e,["label","text","name"]),i=c(e,["parent_id","parentId","pid"]),a=d(e,["is_leaf","leaf"]),l=d(e,["has_children","hasChildren"]),s=d(e,["selected","checked","isChecked"]),o=d(e,["disabled","isDisabled"]),u=c(e,["icon","icon_css","iconClass"]);return a||l?a&&!l?l=0:!a&&l&&(a=0):(a=1,l=0),{id:t,label:String(null==n?t:n),parent_id:i,is_leaf:a,has_children:l,selected:s,disabled:o,icon:u}}(e),a=1===n.has_children||0===n.is_leaf,s=1===n.is_leaf,o=n.icon||(s?"fa fa-file":"fa fa-folder"),u=i?'<span class="ts-icon '+l(o)+'" aria-hidden="true"></span>':"";return'<li class="ts-node" data-node="'+l(n.id)+'" data-level="'+t+'" data-has-children="'+(a?"1":"0")+'" data-leaf="'+(s?"1":"0")+'" aria-expanded="false" role="treeitem" aria-selected="false" tabindex="-1" aria-disabled="'+(n.disabled?"true":"false")+'">'+(a?'<button class="ts-toggle" type="button" aria-label="Toggle" aria-expanded="false"></button>':'<span class="ts-spacer" aria-hidden="true"></span>')+'<label class="ts-label"><input class="ts-check" type="checkbox" '+(n.selected?"checked ":"")+(n.disabled?"disabled ":"")+"/>"+u+'<span class="ts-text">'+f(n.label||n.id)+'</span></label><ul class="ts-children" role="group" hidden></ul></li>'}function v(e,t,n){var i=[];(t||[]).forEach((function(e){i.push(p(e,n))})),e.html(i.join(""))}function g(e){var n,i,a,r=[];return e.find("input.ts-check:checked").each((function(){var e=t(this).closest("li.ts-node").attr("data-node");e&&r.push(e)})),n=r,i=Object.create(null),a=[],n.forEach((function(e){i[e]||(i[e]=1,a.push(e))})),a}function b(e,n){if(e.storeItem){var i=g(n);e.allowParent||(i=i.filter((function(e){return"1"===n.find('li.ts-node[data-node="'+o(e)+'"]').attr("data-leaf")}))),e.allowLeaf||(i=i.filter((function(e){return"1"!==n.find('li.ts-node[data-node="'+o(e)+'"]').attr("data-leaf")})));var a="CSV"===e.storeFormat?function(e){return e.join(",")}(i):function(e){return JSON.stringify(e)}(i);!function(e,n){if(e){var i=apex.item(e);if(i&&i.setValue)i.setValue(n);else{var a=t("#"+e);a.length&&a.val(n).trigger("change")}}}(e.storeItem,a)}}function m(e,t){e&&void 0!==e.indeterminate&&(e.indeterminate=!!t)}function k(e,n){if(n.triState){var i=e.parent().closest("li.ts-node");if(i.length){var a=i.find("> ul.ts-children > li.ts-node");if(a.length){var r=a.filter((function(){var e=t(this);if(e.hasClass("is-disabled"))return!1;var n=e.children(".ts-label").find("input.ts-check").get(0);return n&&!n.disabled})),l=!0,s=!1,o=!1;r.each((function(){var e=t(this).children(".ts-label").find("input.ts-check").get(0);e&&(l=l&&e.checked&&!e.indeterminate,s=s||e.checked,o=o||e.indeterminate)}));var d=i.children(".ts-label").find("input.ts-check").get(0);d&&!d.disabled&&(r.length&&l?(d.checked=!0,m(d,!1),i.addClass("is-checked").removeClass("is-mixed")):s||o?(d.checked=!1,m(d,!0),i.addClass("is-mixed").removeClass("is-checked")):(d.checked=!1,m(d,!1),i.removeClass("is-checked is-mixed"))),k(i,n)}}}}function x(e,n){var i=e.find("li.ts-node").get();i.sort((function(e,n){return t(n).parents("li.ts-node").length-t(e).parents("li.ts-node").length}));for(var a=0;a<i.length;a++)k(t(i[a]),n)}function y(e,t){e.find("> .ts-label > input.ts-check").each((function(){this.checked=!!t,m(this,!1)})),e.find("> ul.ts-children input.ts-check").each((function(){this.checked=!!t,m(this,!1)}))}function w(e,t,n){var i=e.children("ul.ts-children");if(e.data("loaded"))return Promise.resolve(!0);var a=e.attr("data-node");return n.children[a]?(v(i,n.children[a],Number(e.attr("data-level"))+1),e.data("loaded",!0).attr("data-loaded","1"),Promise.resolve(!0)):function(e,t){return u(e,{x01:"children",x02:r(t)})}(t,a).then((function(t){return n.children[a]=t||[],v(i,n.children[a],Number(e.attr("data-level"))+1),e.data("loaded",!0).attr("data-loaded","1"),!0}))}function S(e,t){var n=e.children("ul.ts-children"),i=e.children(".ts-toggle");t?(e.attr("aria-expanded","true"),i.length&&i.attr("aria-expanded","true"),n.prop("hidden",!1)):(e.attr("aria-expanded","false"),i.length&&i.attr("aria-expanded","false"),n.prop("hidden",!0))}function T(e){var t=Object.create(null);return e.forEach((function(e){var n=null==e.parentId?"_ROOT_":String(e.parentId);t[n]||(t[n]=[]),t[n].push(e)})),t}function _(e,n,a,r){var s=n[a]||[];s.sort((function(e,t){var n=(e.label||"").toLowerCase(),i=(t.label||"").toLowerCase();return n<i?-1:n>i?1:0}));var o=s.map((function(e){return function(e,t){var n=!0===e.hasChildren||1===e.hasChildren||!1===e.leaf||0===e.leaf,a=!0===e.leaf||1===e.leaf,r=e.icon||(a?"fa fa-file":"fa fa-folder"),s=i?'<span class="ts-icon '+l(r)+'" aria-hidden="true"></span>':"";return'<li class="ts-node" data-node="'+l(e.id)+'" data-level="'+t+'" data-has-children="'+(n?"1":"0")+'" data-leaf="'+(a?"1":"0")+'" aria-expanded="false" role="treeitem" aria-selected="false" tabindex="-1">'+(n?'<button class="ts-toggle" type="button" aria-label="Toggle" aria-expanded="false"></button>':'<span class="ts-spacer" aria-hidden="true"></span>')+'<label class="ts-label"><input class="ts-check" type="checkbox"'+(e.selected?" checked":"")+(e.disabled?" disabled":"")+">"+s+'<span class="ts-text">'+f(e.label||e.id)+'</span></label><ul class="ts-children" role="group" hidden></ul></li>'}(e,r)})).join("");e.html(o),e.children("li.ts-node").each((function(){var e=t(this).attr("data-node"),i=String(e);n[i]&&n[i].length&&(_(t(this).children("ul.ts-children"),n,i,r+1),S(t(this),!0))}))}function I(e,n,i){var a=e.find('li.ts-node[data-has-children="1"]').filter((function(){return!t(this).data("loaded")}));if(!a.length)return Promise.resolve(!0);var r=[];return a.each((function(){r.push(t(this).attr("data-node"))})),function(e,t){return u(e,{x01:"children_batch",x02:t})}(n,r.join(",")).then((function(r){if(0===(r=r||[]).length){var l=[];return a.each((function(){var e=t(this);e.data("loaded")||l.push(w(e,n,i))})),Promise.all(l).then((function(){return I(e.find("> li.ts-node, ul.ts-children > li.ts-node"),n,i)}))}var s=Object.create(null);r.forEach((function(e){var t=String(e.parentId);(s[t]=s[t]||[]).push(e)}));return a.each((function(){var e=t(this),n=String(e.attr("data-node")),a=e.children("ul.ts-children"),r=s[n]||[];i.children[n]=r,v(a,r,Number(e.attr("data-level"))+1),e.data("loaded",!0).attr("data-loaded","1")})),I(e.find("> li.ts-node, ul.ts-children > li.ts-node"),n,i)}))}function C(e,n){var i=e.find("li.ts-node"),a=n.trim();if(i.removeClass("ts-hidden-by-search"),e.find("mark.ts-hit").each((function(){var e=t(this);e.replaceWith(e.text())})),!a)return 0;var r=[].slice.call(i.get()).reverse(),l=0;return r.forEach((function(e){var n=t(e),i=n.find("> ul.ts-children > li.ts-node"),r=function(e){var t=e.children(".ts-label").find(".ts-text"),n=t.text(),i=s(a);return!!new RegExp(i.source,"i").test(n)&&(t.html(n.replace(i,(function(e){return'<mark class="ts-hit">'+e+"</mark>"}))),!0)}(n),o=!1;i.each((function(){t(this).hasClass("ts-hidden-by-search")||(o=!0)})),r||o?(r&&l++,n.parents("li.ts-node").each((function(){S(t(this),!0),t(this).removeClass("ts-hidden-by-search")}))):n.addClass("ts-hidden-by-search")})),e.find('li.ts-node[aria-expanded="true"]').each((function(){var e=t(this);0===e.find("> ul.ts-children > li.ts-node:not(.ts-hidden-by-search)").length&&S(e,!1)})),l}function E(e,i,r,l){var s=e.find('[data-tree-role="search"], .ts-search');if(s.length&&"NONE"!==i.searchMode){var o=e.find("ul.t-TreeSelect-list"),d=n.debounce((function(){var n=(s.val()||"").trim();if(function(e){a=e||"","NONE"}(n),n)if("SERVER"!==i.searchMode){var d=e.find('li.ts-node[data-has-children="1"]').filter((function(){return!t(this).data("loaded")})).length>0?I(o,i,r):Promise.resolve(!0);h(e,d.then((function(){return C(e,n)})))}else{var c=g(e);(function(e,t){return u(e,{x01:"search",x03:t})})(i,n).then((function(n){var i=Object.create(null);(n||[]).forEach((function(e){i[String(e.id)]=e})),(n||[]).forEach((function e(t){var n=t.parent_id||t.parentId;if(n){var a=String(n);if(!i[a]){var l=null;(r.roots||[]).forEach((function(e){String(e.id)===a&&(l=e)})),l||Object.keys(r.children).some((function(e){var t=(r.children[e]||[]).find((function(e){return String(e.id)===a}));return!!t&&(l=t,!0)})),l&&(i[a]=l,e(l))}}}));var a=T(Object.keys(i).map((function(e){return i[e]})));o.empty(),_(o,a,"_ROOT_",1),e.find('li.ts-node[data-has-children="1"]').each((function(){S(t(this),!0)})),c.forEach((function(n){var i=e.find('.ts-node[data-node="'+apex.util.escapeCSS(String(n))+'"]');if(i.length){var a=i.find("> .ts-label .ts-check").get(0);a&&!a.checked&&(a.checked=!0,t(a).trigger("change"))}}))}))}else"SERVER"===i.searchMode?l():function(){e.find(".ts-hidden-by-search").removeClass("ts-hidden-by-search"),e.find("mark.ts-hit").each((function(){var e=t(this);e.replaceWith(e.text())})),v(o,r.roots,1);var n=Number(i.defaultExpand||0);n>0&&function n(a,l,s){if(l>=s)return Promise.resolve();var o=[];return a.children('li.ts-node[data-has-children="1"]').each((function(){var e=t(this);o.push(w(e,i,r).then((function(){S(e,!0)})))})),Promise.all(o).then((function(){return n(e.find("ul.ts-children:not([hidden])"),l+1,s)}))}(o,0,n)}()}),200);s.off("input.ts search.ts").on("input.ts search.ts",d),s.off("keydown.ts").on("keydown.ts",(function(e){"Enter"===e.key&&(e.preventDefault(),d())}))}}function O(e,t){e.find("li.ts-node[tabindex='0']").attr("tabindex","-1"),t.attr("tabindex","0").focus()}"function"!=typeof n.debounce&&(n.debounce=function(e,t){var n=null;return function(){var i=this,a=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(i,a)}),t)}}),e.xxTreeSelectInit=function(e){!(e=t.extend({},{storeFormat:"JSON",allowParent:!0,allowLeaf:!0,triState:!0,defaultExpand:0,searchMode:"NONE",hotkeys:!0},e||{})).staticId&&e.regionStaticId&&(e.staticId=e.regionStaticId);var a=t("#"+e.staticId);if(a.length&&!a.find("ul.t-TreeSelect-list").length){var r=a.find(".t-TreeSelect").first();r.length&&(a=r)}if(a.attr("data-has-icons",e.hasIcons?"true":"false"),i=!!e.hasIcons,a.length||(a=t(".t-TreeSelect#"+n.escapeCSS(e.staticId))),a.length){var l=a.find("ul.t-TreeSelect-list");l.length||console.warn("[TreeSelect] Missing <ul class='t-TreeSelect-list'> inside region.");var s={roots:[],children:Object.create(null)};d(),a.on("click.ts","button.ts-toggle",(function(){var n=t(this).closest("li.ts-node");"true"===n.attr("aria-expanded")?S(n,!1):w(n,e,s).then((function(){S(n,!0)}))})),a.on("change.ts","input.ts-check",(function(){var n=t(this).closest("li.ts-node");if(!e.allowParent&&"1"!==n.attr("data-leaf"))return this.checked=!1,void(this.indeterminate=!1);if(!e.allowLeaf&&"1"===n.attr("data-leaf"))return this.checked=!1,void(this.indeterminate=!1);if(e.triState&&"1"===n.attr("data-has-children")){if("true"!==n.attr("aria-expanded")){var i=this;return void w(n,e,s).then((function(){y(n,!!i.checked),k(n,e),b(e,a)}))}y(n,!!this.checked)}k(n,e),b(e,a)})),a.on("click.ts",".ts-expandAll",(function(){var n=l.children("li.ts-node").length?Promise.resolve():d();h(a,n.then((function(){return I(l,e,s)})).then((function(){var n=[];return a.find('li.ts-node[data-has-children="1"]').each((function(){var i=t(this);i.data("loaded")||n.push(w(i,e,s))})),Promise.all(n)})).then((function(){a.find('li.ts-node[data-has-children="1"]').each((function(){S(t(this),!0)}))})))})),a.on("click.ts",".ts-collapseAll",(function(){a.find('li.ts-node[aria-expanded="true"]').each((function(){S(t(this),!1)}))})),e.hotkeys&&(a.attr("role","tree"),a.on("click.ts","li.ts-node",(function(e){t(e.target).is("input,button,label")||O(a,t(this))})),a.on("keydown.ts",(function(n){var i=a.find("li.ts-node[tabindex='0']");if(i.length){var r=!0;switch(n.key){case"ArrowDown":var l=function(e){var n="true"===e.attr("aria-expanded")?e.find("> ul.ts-children > li.ts-node"):t();if(n.length)return t(n.get(0));var i=e.next("li.ts-node");if(i.length)return i;for(var a=e.parent().closest("li.ts-node");a.length&&!a.next("li.ts-node").length;)a=a.parent().closest("li.ts-node");return a.length?a.next("li.ts-node"):t()}(i);l&&l.length&&O(a,l);break;case"ArrowUp":var o=function(e){var n=e.prev("li.ts-node");if(n.length){for(;"true"===n.attr("aria-expanded")&&n.find("> ul.ts-children > li.ts-node").length;){var i=n.find("> ul.ts-children > li.ts-node");n=t(i.get(i.length-1))}return n}return e.parent().closest("li.ts-node")}(i);o&&o.length&&O(a,o);break;case"ArrowRight":if("1"===i.attr("data-has-children"))if("true"!==i.attr("aria-expanded"))w(i,e,s).then((function(){S(i,!0)}));else{var d=i.find("> ul.ts-children > li.ts-node");d.length&&O(a,t(d.get(0)))}break;case"ArrowLeft":if("true"===i.attr("aria-expanded"))S(i,!1);else{var c=i.parent().closest("li.ts-node");c.length&&O(a,c)}break;case" ":case"Enter":var u=i.children(".ts-label").find("input.ts-check").get(0);u&&!u.disabled&&(u.checked=!u.checked,t(u).trigger("change"));break;default:r=!1}r&&(n.preventDefault(),n.stopPropagation())}}))),E(a,e,s,d),function(){var t=void 0!==l&&l&&l.length?l:a;function n(n){for(var i=t.find("li.ts-node > .ts-label > input.ts-check:not(:disabled)").get(),r=0;r<i.length;r++)i[r].checked=n,i[r].indeterminate=!1;if(x(a,e),b(e,a),a[0]){var l=g(a);a[0].dispatchEvent(new CustomEvent("xx:change",{detail:{ids:l,changed:{id:null,state:n,branch:!1},mode:"bulk",staticId:e.staticId}}))}}function i(){return t.find("li.ts-node").length?Promise.resolve():d()}a.off("click.ts",".ts-checkAll").on("click.ts",".ts-checkAll",(function(r){!0===r.shiftKey?h(a,i().then((function(){return I(t,e,s)})).then((function(){n(!0)}))):n(!0)})),a.off("click.ts",".ts-uncheckAll").on("click.ts",".ts-uncheckAll",(function(r){!0===r.shiftKey?h(a,i().then((function(){return I(t,e,s)})).then((function(){n(!1)}))):n(!1)}))}(),function(){var e=a.children(".ts-menu");e.length||(e=t('<div class="ts-menu" role="menu" aria-hidden="true"></div>').appendTo(a));var n=a.children(".ts-overlay");n.length||(n=t('<div class="ts-overlay" aria-hidden="true"></div>').appendTo(a));var i=n.children(".ts-dialog");i.length||(i=t('<div class="ts-dialog" role="dialog" aria-modal="true" aria-labelledby="tsDialogTitle" aria-describedby="tsDialogBody"><div class="ts-dialog__hdr"><div id="tsDialogTitle">Node Info</div><button type="button" class="ts-dialog__close" aria-label="Close">Close</button></div><div class="ts-dialog__body" id="tsDialogBody"></div></div>').appendTo(n));var r=null,l=null;function s(){e.hide().attr("aria-hidden","true").empty(),r=null,t(document).off(".tsMenu"),t(window).off(".tsMenu")}function o(n,i){var a=e.outerWidth(),r=e.outerHeight(),l=t(window).width(),s=t(window).height(),o=Math.min(Math.max(0,n),l-a-4),d=Math.min(Math.max(0,i),s-r-4);e.css({left:o,top:d})}l=null;function d(){if(l&&"function"==typeof l.focus)try{l.focus()}catch(e){}n.attr("aria-hidden","true").hide(),t(document).off("keydown.tsDlg"),n.off("mousedown.tsDlg")}function c(e){try{return apex.util.escapeHTML(e)}catch(t){return String(e).replace(/[&<>"]/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[e])))}}function u(a){var r=function(e){var t=e.attr("data-id")||e.data("id")||e.attr("data-node")||e.attr("id")||"",n=e.find("> .ts-label"),i=(n.find(".ts-text").text()||n.clone().children().remove().end().text()).trim();return{id:String(t),label:i}}(a);t('<div class="ts-mi" role="menuitem" tabindex="-1">Info…</div>').on("click",(function(e){e.preventDefault(),e.stopPropagation(),s();var a,o="<p><strong>ID:</strong> "+(r.id?c(r.id):"<em>—</em>")+"</p><p><strong>Label:</strong> "+c(r.label)+"</p>";a=o,l=document.activeElement,i.find(".ts-dialog__body").html(a),n.attr("aria-hidden","false").css("display","flex"),i.show(),(i.find('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])').get(0)||i[0]).focus(),t(document).on("keydown.tsDlg",(function(e){"Escape"===e.key&&d()})),n.on("mousedown.tsDlg",(function(e){t(e.target).closest(".ts-dialog").length||d()}))})).appendTo(e),t('<div class="ts-mi" role="menuitem" tabindex="-1">Open Oracle APEX site</div>').on("click",(function(e){e.preventDefault(),e.stopPropagation(),s();var t="https://apex.oracle.com/";apex.navigation&&apex.navigation.openInNewWindow?apex.navigation.openInNewWindow(t):window.open(t,"_blank","noopener")})).appendTo(e)}i.on("click",".ts-dialog__close",(function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),d()})),a.on("contextmenu.ts","li.ts-node > .ts-label",(function(n){n.preventDefault(),n.stopPropagation(),r=t(this).closest("li.ts-node"),e.empty(),u(r),e.show().attr("aria-hidden","false"),o(n.clientX,n.clientY),setTimeout((function(){t(document).on("mousedown.tsMenu",(function(e){t(e.target).closest(".ts-menu").length||s()})),t(document).on("keydown.tsMenu",(function(e){"Escape"===e.key&&s()})),t(window).on("scroll.tsMenu resize.tsMenu",s)}),0)})),a.on("keydown.ts","li.ts-node > .ts-label",(function(n){if(n.shiftKey&&"F10"===n.key){n.preventDefault(),n.stopPropagation();var i=this.getBoundingClientRect();r=t(this).closest("li.ts-node"),e.empty(),u(r),e.show().attr("aria-hidden","false"),o(i.left+8,i.top+8),setTimeout((function(){t(document).on("mousedown.tsMenu",(function(e){t(e.target).closest(".ts-menu").length||s()})),t(document).on("keydown.tsMenu",(function(e){"Escape"===e.key&&s()})),t(window).on("scroll.tsMenu resize.tsMenu",s)}),0)}}))}(),a.data("treeSelect",function(e,n,i,a){return{refresh:a,getSelectedIds:function(){return g(e)},checkAllVisible:function(){e.find("input.ts-check:not(:disabled)").each((function(){this.checked=!0,m(this,!1)})),b(n,e)},uncheckAllVisible:function(){e.find("input.ts-check:not(:disabled)").each((function(){this.checked=!1,m(this,!1)})),b(n,e)},expandAllOneLevel:function(){e.find("li.ts-node[data-has-children='1']").each((function(){var e=t(this);w(e,n,i).then((function(){S(e,!0)}))}))},destroy:function(){e.off(".ts"),e.removeData("treeSelect"),e.find("ul.t-TreeSelect-list").empty()}}}(a,e,s,d))}else console.warn("[TreeSelect] Container not found for staticId:",e.staticId);function o(n,i,r){if(i>=r)return Promise.resolve();var l=[];return n.children("li.ts-node").each((function(){var n=t(this);"1"===n.attr("data-has-children")&&l.push(w(n,e,s).then((function(){S(n,!0)})))})),Promise.all(l).then((function(){return o(a.find("ul.ts-children:not([hidden])"),i+1,r)}))}function d(){return function(e){return u(e,{x01:"roots"})}(e).then((function(t){if(t=t||[],"STATIC_JSON"===e.dataSourceType){var n=T(t);s.roots=n._ROOT_||[],l.empty(),_(l,n,"_ROOT_",1)}else s.roots=t,v(l,s.roots,1);var i=Number(e.defaultExpand||0);if(i>0)o(l,0,i).then((function(){b(e,a);var t=l.children("li.ts-node").first();t.length&&t.attr("tabindex","0")}));else{b(e,a);var r=l.children("li.ts-node").first();r.length&&r.attr("tabindex","0")}}))}}}(window,apex.jQuery,apex.util);